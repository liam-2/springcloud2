<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.george.springcloud.dao.DepartmentDao">

    <resultMap id="DepartmentMap" type="com.george.springcloud.domain.DepartmentDomain">
        <id column="id" property="id" jdbcType="BIGINT"/>
        <result column="create_time" property="createTime" jdbcType="TIMESTAMP"/>
        <result column="modify_time" property="modifyTime" jdbcType="TIMESTAMP"/>
        <result column="version" property="version" jdbcType="INTEGER"/>
        <result column="parent_id" property="parentId" jdbcType="BIGINT"/>
		<result column="code" property="code" jdbcType="VARCHAR"/>
		<result column="name" property="name" jdbcType="VARCHAR"/>
		<result column="ancestors" property="ancestors" jdbcType="VARCHAR"/>
		<result column="level" property="level" jdbcType="INTEGER"/>
		<result column="sort" property="sort" jdbcType="INTEGER"/>
		<result column="remark" property="remark" jdbcType="VARCHAR"/>
		<result column="is_delete" property="isDelete" jdbcType="TINYINT"/>
    </resultMap>

    <insert id="increaseDepartment" parameterType="com.george.springcloud.domain.DepartmentDomain" >
        insert ignore into sys_department(parent_id,code,name,ancestors,level,sort,remark)
        values(#{departmentDomain.parentId},
               #{departmentDomain.code},
               #{departmentDomain.name},
               #{departmentDomain.ancestors},
               #{departmentDomain.level},
               #{departmentDomain.sort},
               #{departmentDomain.remark})
    </insert>

	<update id="deleteDepartmentById" parameterType="Long">
		update sys_department set is_delete=1,version=version+1 where id=#{id};
	</update>

	<update id="deleteDepartmentByCode" parameterType="string">
		update sys_department set is_delete=1,version=version+1 where code=#{code};
	</update>

	<update id="deleteDepartmentByName" parameterType="string">
		update sys_department set is_delete=1,version=version+1 where name=#{name};
	</update>

	<update id="updateDepartment" parameterType="com.george.springcloud.domain.DepartmentDomain">
		update sys_department set version=version+1,
		                          parent_id=#{departmentDomain.parentId},
		                          code=#{departmentDomain.code},
		                          name=#{departmentDomain.name},
		                          ancestors=#{departmentDomain.ancestors},
		                          level=#{departmentDomain.level},
		                          sort=#{departmentDomain.sort},
		                          remark=#{departmentDomain.remark}
		where id=#{departmentDomain.id} and is_delete=0;
	</update>

	<select id="getAllCode"  resultType="java.lang.String">
		select code from sys_department where  is_delete=0;
	</select>

	<select id="getAllName"  resultType="java.lang.String">
		select name from sys_department where  is_delete=0;
	</select>


</mapper>
